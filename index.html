<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Advisor - Indian Equity Market</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <style>
        .portfolio-card {
            transition: transform 0.3s;
        }
        .portfolio-card:hover {
            transform: translateY(-5px);
        }
        .signal-buy {
            border-left: 4px solid #28a745;
        }
        .signal-hold {
            border-left: 4px solid #ffc107;
        }
        .signal-sell {
            border-left: 4px solid #dc3545;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .advisor-section {
            background-color: #f8f9fa;
            border-radius: 0.375rem;
            padding: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">Portfolio Advisor</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Portfolios</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Reports</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Settings</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Portfolio Overview Section -->
        <div class="row mb-4">
            <div class="col-12">
                <h2>Portfolio Dashboard</h2>
                <p class="text-muted">Manage your client stock portfolios in the Indian equity market</p>
            </div>
        </div>

        <!-- Portfolio Cards -->
        <div class="row" id="portfolio-cards">
            <!-- Portfolio cards will be dynamically loaded here -->
        </div>

        <!-- Charts Section -->
        <div class="row mt-5">
            <div class="col-12">
                <h3>Performance Analytics</h3>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Portfolio Value Trend</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="portfolioTrendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5>Sector Allocation</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="sectorAllocationChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advisory Signals Section -->
        <div class="row mt-5 advisor-section">
            <div class="col-12">
                <h3>Advisory Signals</h3>
                <p class="text-muted">Based on historical performance, technical indicators, sector potential, and market buzz</p>
            </div>
            <div class="col-12">
                <div class="table-responsive">
                    <table class="table table-striped" id="advisory-signals-table">
                        <thead>
                            <tr>
                                <th>Stock</th>
                                <th>Current Price</th>
                                <th>Signal</th>
                                <th>Confidence</th>
                                <th>Reason</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Advisory signals will be dynamically loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Global variables
        let portfolios = [];
        let advisorySignals = [];

        // DOM Content Loaded event
        document.addEventListener('DOMContentLoaded', function() {
            loadPortfolios();
            loadAdvisorySignals();
            initializeCharts();
        });

        // Load portfolios from backend API
        async function loadPortfolios() {
            try {
                const response = await fetch('/api/portfolios');
                portfolios = await response.json();
                renderPortfolioCards();
            } catch (error) {
                console.error('Error loading portfolios:', error);
                // Fallback to dummy data
                loadDummyPortfolios();
            }
        }

        // Load advisory signals from backend API
        async function loadAdvisorySignals() {
            try {
                const response = await fetch('/api/advisory-signals');
                advisorySignals = await response.json();
                renderAdvisorySignals();
            } catch (error) {
                console.error('Error loading advisory signals:', error);
                // Fallback to dummy data
                loadDummyAdvisorySignals();
            }
        }

        // Initialize charts
        function initializeCharts() {
            // Portfolio Trend Chart
            const trendCtx = document.getElementById('portfolioTrendChart').getContext('2d');
            new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Portfolio Value (₹)',
                        data: [1200000, 1250000, 1180000, 1320000, 1400000, 1450000],
                        borderColor: '#007bff',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // Sector Allocation Chart
            const sectorCtx = document.getElementById('sectorAllocationChart').getContext('2d');
            new Chart(sectorCtx, {
                type: 'pie',
                data: {
                    labels: ['Technology', 'Financial', 'Healthcare', 'Consumer', 'Energy'],
                    datasets: [{
                        data: [30, 25, 20, 15, 10],
                        backgroundColor: ['#007bff', '#28a745', '#dc3545', '#ffc107', '#6f42c1']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Render portfolio cards
        function renderPortfolioCards() {
            const container = document.getElementById('portfolio-cards');
            container.innerHTML = '';

            portfolios.forEach(portfolio => {
                const card = `
                    <div class="col-md-4 mb-4">
                        <div class="card portfolio-card">
                            <div class="card-body">
                                <h5 class="card-title">${portfolio.name}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">Client: ${portfolio.clientName}</h6>
                                <p class="card-text">
                                    <strong>Value: ₹${portfolio.currentValue.toLocaleString()}</strong><br>
                                    <small>Return: <span class="${portfolio.return >= 0 ? 'text-success' : 'text-danger'}">${portfolio.return}%</span></small>
                                </p>
                                <a href="#" class="btn btn-primary btn-sm">View Details</a>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        // Render advisory signals
        function renderAdvisorySignals() {
            const tableBody = document.querySelector('#advisory-signals-table tbody');
            tableBody.innerHTML = '';

            advisorySignals.forEach(signal => {
                const row = `
                    <tr class="signal-${signal.signal.toLowerCase()}">
                        <td>${signal.stock}</td>
                        <td>₹${signal.currentPrice}</td>
                        <td>
                            <span class="badge bg-${getSignalBadgeColor(signal.signal)}">
                                ${signal.signal}
                            </span>
                        </td>
                        <td>${signal.confidence}%</td>
                        <td>${signal.reason}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="executeTrade('${signal.stock}', '${signal.signal}')">
                                Execute
                            </button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        // Get badge color based on signal
        function getSignalBadgeColor(signal) {
            switch (signal) {
                case 'Buy': return 'success';
                case 'Hold': return 'warning';
                case 'Sell': return 'danger';
                default: return 'secondary';
            }
        }

        // Execute trade function
        function executeTrade(stock, signal) {
            alert(`Executing ${signal} order for ${stock}`);
            // Implementation for trade execution would go here
        }

        // Dummy data fallback functions
        function loadDummyPortfolios() {
            portfolios = [
                { id: 1, name: 'Growth Portfolio', clientName: 'Rahul Sharma', currentValue: 1450000, return: 12.5 },
                { id: 2, name: 'Income Portfolio', clientName: 'Priya Patel', currentValue: 890000, return: 8.2 },
                { id: 3, name: 'Balanced Portfolio', clientName: 'Amit Kumar', currentValue: 1230000, return: 9.8 }
            ];
            renderPortfolioCards();
        }

        function loadDummyAdvisorySignals() {
            advisorySignals = [
                { stock: 'RELIANCE', currentPrice: 2850, signal: 'Buy', confidence: 85, reason: 'Strong technical indicators and positive sector outlook' },
                { stock: 'INFY', currentPrice: 1850, signal: 'Hold', confidence: 75, reason: 'Stable performance, wait for earnings report' },
                { stock: 'HDFCBANK', currentPrice: 1650, signal: 'Sell', confidence: 90, reason: 'Overvalued based on current market conditions' },
                { stock: 'TCS', currentPrice: 3450, signal: 'Buy', confidence: 92, reason: 'Excellent fundamentals and growth potential' }
            ];
            renderAdvisorySignals();
        }

        // Error handling for API calls
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
        });
    </script>
</body>
</html>